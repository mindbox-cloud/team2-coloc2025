(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}})();function B(r,t,e,s){const n=[{xStart:0,yStart:0},{xStart:s-1,yStart:0},{xStart:0,yStart:s-1},{xStart:s-1,yStart:s-1}][t];let o=0;const c=Math.ceil(Math.sqrt(r.size));for(let l=0;l<c&&o<r.size;l++)for(let i=0;i<c&&o<r.size;i++){const d=n.xStart+(t%2===0?i:-i),m=n.yStart+(t<2?l:-l);d>=0&&d<s&&m>=0&&m<s&&!e[m][d]&&(e[m][d]={army:r,currentHp:r.hp},o++)}}function F(r,t,e){const[s,a]=r,n=e[a][s];if(n){const o=Math.random()<t.army.criticalPercent/100,c=o?t.army.strength*2:t.army.strength;n.currentHp-=c,n.attacked={by:t,damage:c,isCritical:o},n.currentHp<=0&&(e[a][s]=null)}}function D(r,t,e,s,a){let n=null,o=1/0;for(let c=-s;c<=s;c++)for(let l=-s;l<=s;l++){const i=t+l,d=e+c,m=l===0&&c===0,u=d>=0&&d<r.length&&i>=0&&i<r[d].length?r[d][i]:null,L=u&&u.army!==a;if(!m&&L){const f=Math.abs(l)+Math.abs(c);f<o&&(o=f,n=[i,d])}}return n}function N(r,t,e,s){return Math.abs(r-e)<=1&&Math.abs(t-s)<=1&&!(r===e&&t===s)}const H=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,-1],[1,-1],[-1,1]];function Y(r){const t=[...r];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}function q(r,t,e,s,a){const n=Y(H);for(const[o,c]of n){const l=e+o,i=s+c;if(i>=0&&i<r.length&&l>=0&&l<r[i].length&&!t[i][l]){t[i][l]=a,t[s][e]=null;break}}}function O(r,t,e,s,a,n,o){var b;const c=[],l=a-e,i=n-s,d=l===0?0:l>0?1:-1,m=i===0?0:i>0?1:-1;Math.abs(l)>=Math.abs(i)?c.push([d,0],[d,m],[0,m],[0,-m],[-d,0]):c.push([0,m],[d,m],[d,0],[-d,0],[0,-m]);for(const[u,L]of c){const f=e+u,p=s+L;if(p>=0&&p<r.length&&f>=0&&f<r[p].length&&!t[p][f]&&(!r[p][f]||((b=r[p][f])==null?void 0:b.army)!==o.army)){t[p][f]=o,t[s][e]=null;return}}}function X(r,t,e,s,a,n){const o=D(s,r,t,e.army.visionLength,e.army);if(o){const l=n.get(e.army),i=Math.abs(r-o[0])+Math.abs(t-o[1]);if((!l||i<Math.abs(r-l[0])+Math.abs(t-l[1]))&&n.set(e.army,o),N(r,t,o[0],o[1])){F(o,e,a);return}O(s,a,r,t,o[0],o[1],e);return}const c=n.get(e.army);c?N(r,t,c[0],c[1])?F(c,e,a):O(s,a,r,t,c[0],c[1],e):q(s,a,r,t,e)}function $(r){const{fieldSize:t,armies:e}=r,s=Array.from({length:t},()=>Array.from({length:t},()=>null));return e.forEach((a,n)=>{B(a,n,s,t)}),{state:s,makeTurn(){const a=this.state.map(o=>o.slice()),n=new Map;for(let o=0;o<this.state.length;o++)for(let c=0;c<this.state[o].length;c++){const l=this.state[o][c];l&&(delete l.attacked,X(c,o,l,this.state,a,n))}this.state=a},hasOnlyOneArmyLeft(){const a=new Set;for(let n=0;n<this.state.length;n++)for(let o=0;o<this.state[n].length;o++){const c=this.state[n][o];c&&a.add(c.army)}return Array.from(a).length===1}}}const S="game-field";function j(r){const t=document.createElement("div");t.classList.add("field-root"),t.style.setProperty("--n",r.toString()),t.id=S;for(let e=0;e<r;e++)for(let s=0;s<r;s++){const a=document.createElement("div");a.classList.add("field-cell"),t.append(a)}return t}function G(r,t){const e=document.getElementById(S);if(e&&e.style.getPropertyValue("--n")===r.toString())return e;e==null||e.remove();const s=j(r);return t.append(s),s}function _(){const r=document.createElement("div");return r.classList.add("game-soldier-icon"),r.innerHTML='<svg><use href="#icon-soldier" /></svg>',r}function P(r,t,e=null){const s=G(t.length,r);for(let a=0;a<t.length;a++)for(let n=0;n<t[a].length;n++){const o=s.children[a*t.length+n],c=t[a][n];o.removeAttribute("style"),o.innerHTML="",o.classList.remove("field-cell-damaged"),c&&(o.style.setProperty("--color",c.army.color),o.style.setProperty("--hp-percent",`${c.currentHp/c.army.hp*100}%`),o.append(_())),c!=null&&c.attacked&&o.classList.add("field-cell-damaged")}}const R=[{id:"size",label:"Размер армии:",min:1,max:100,default:10},{id:"hp",label:"Здоровье солдата:",min:1,max:100,default:10},{id:"strength",label:"Сила удара:",min:1,max:100,default:1},{id:"visionLength",label:"Дальность обзора:",min:1,max:100,default:3},{id:"criticalPercent",label:"Шанс критического удара:",min:0,max:100,default:10}],k=["#0d6efd","#dc3545","#20c997","#0dcaf0"];function U(r){const t=document.createElement("form"),e=[];t.classList.add("p-3");const s=document.createElement("div");s.classList.add("mb-3","col-3");const a=document.createElement("label");a.textContent="Размер поля (N):",a.classList.add("form-label");const n=document.createElement("input");n.type="number",n.classList.add("form-control"),n.required=!0,n.min="1",n.max="100",n.value="10",s.append(a,n);const o=document.createElement("div");o.classList.add("mb-3","col-3");const c=document.createElement("label");c.textContent="Интервал (мс):",c.classList.add("form-label");const l=document.createElement("input");l.type="number",l.classList.add("form-control"),l.required=!0,l.min="1",l.value="500",o.append(c,l);const i=()=>{const u=document.createElement("button");return u.type="submit",u.textContent="Запустить",u.classList.add("btn","btn-primary"),u},d=()=>{const u=document.createElement("button");u.type="button",u.textContent="Добавить армию",u.classList.add("btn","btn-secondary");const L=document.createElement("div");return L.classList.add("mb-3","row","flex-nowrap","gap-3"),u.addEventListener("click",()=>{const f=e.length;if(f<=3){const p=document.createElement("div");p.classList.add("card","mb-3","p-3","col-2");const C=document.createElement("h6");C.textContent=`Армия #${f+1}`,C.classList.add("card-title","mb-2"),p.appendChild(C);const v={color:k[f]};R.forEach(g=>{const x=document.createElement("div");x.classList.add("mb-2");const M=document.createElement("label");M.textContent=g.label,M.classList.add("form-label","col-form-label-sm"),M.htmlFor=`army-${f}-${g.id}`;const y=document.createElement("input");y.type="number",y.id=`army-${f}-${g.id}`,y.classList.add("form-control","form-control-sm"),y.required=!0,y.min=g.min.toString(),y.max=g.max.toString(),y.value=g.default.toString(),y.addEventListener("change",()=>{v[g.id]=Number(y.value)}),v[g.id]=g.default,x.append(M,y),p.appendChild(x)});const E=document.createElement("input");E.type="color",E.value=v.color;const T=document.createElement("label");T.textContent="Цвет армии:",T.classList.add("form-label","col-form-label-sm"),E.addEventListener("change",()=>{v.color=E.value}),p.appendChild(T),p.appendChild(E),e.push(v),L.appendChild(p),t.insertAdjacentElement("beforeend",L)}else alert("Максимальное количество армий - 4")}),u},m=document.createElement("div");m.append(d(),i()),m.classList.add("btn-group");const b=document.createElement("div");return b.append(o,s),b.classList.add("row","mt-2"),t.append(m,b),t.addEventListener("submit",u=>{console.log(e),u.preventDefault(),e.length>1?r({fieldSize:Number(n.value),intervalMs:Number(l.value),armies:e}):alert("Армий должно быть больше одной")}),t}function A(r){return t=>{t.preventDefault(),r()}}function W(r,t){const e=document.createElement("div");e.classList.add("d-flex","my-3","justify-content-center"),e.style.gap="0.5em";const s=document.createElement("button");s.classList.add("btn","btn-secondary","game-btn-pause"),s.textContent="Пауза",s.addEventListener("click",A(t.pause));const a=document.createElement("button");a.classList.add("btn","btn-primary","game-btn-play"),a.textContent="Продолжить",a.addEventListener("click",A(t.play));const n=document.createElement("button");n.classList.add("btn","btn-warning"),n.textContent="Новая игра",n.addEventListener("click",A(t.reset)),e.append(s,a,n),r.append(e)}const h=document.getElementById("app");let I;function K(r){h.innerHTML="",clearInterval(I);const t=$(r);function e(){h.classList.add("game-playing"),h.classList.remove("game-paused"),I=setInterval(()=>{const n=t.state;if(t.hasOnlyOneArmyLeft()){s();return}t.makeTurn(),P(h,t.state,n)},r.intervalMs)}function s(){document.getElementById("game-field").classList.add("game-finished"),h.classList.add("game-finished"),clearInterval(I)}function a(){h.classList.add("game-paused"),h.classList.remove("game-playing"),clearInterval(I)}P(h,t.state),W(h,{pause:a,play:e,reset:w}),e()}function w(){clearInterval(I),h.innerHTML="";const r=U(K);h.append(r)}w();
