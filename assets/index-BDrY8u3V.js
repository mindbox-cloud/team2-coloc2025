(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();function H(n,t,e,r){const a=[{xStart:0,yStart:0},{xStart:r-1,yStart:0},{xStart:0,yStart:r-1},{xStart:r-1,yStart:r-1}][t];let s=0;const c=Math.ceil(Math.sqrt(n.size));for(let l=0;l<c&&s<n.size;l++)for(let i=0;i<c&&s<n.size;i++){const d=a.xStart+(t%2===0?i:-i),m=a.yStart+(t<2?l:-l);d>=0&&d<r&&m>=0&&m<r&&!e[m][d]&&(e[m][d]={army:n,currentHp:n.hp},s++)}}function F(n,t,e){const[r,o]=n,a=e[o][r];if(a){const c=Math.random()<t.army.criticalPercent/100?t.army.strength*2:t.army.strength;a.currentHp-=c,a.currentHp<=0&&(e[o][r]=null)}}function O(n,t,e,r,o){let a=null,s=1/0;for(let c=-r;c<=r;c++)for(let l=-r;l<=r;l++){const i=t+l,d=e+c,m=l===0&&c===0,u=d>=0&&d<n.length&&i>=0&&i<n[d].length?n[d][i]:null,v=u&&u.army!==o;if(!m&&v){const f=Math.abs(l)+Math.abs(c);f<s&&(s=f,a=[i,d])}}return a}function P(n,t,e,r){return Math.abs(n-e)<=1&&Math.abs(t-r)<=1&&!(n===e&&t===r)}const D=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[-1,-1],[1,-1],[-1,1]];function X(n){const t=[...n];for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}function Y(n,t,e,r,o){const a=X(D);for(const[s,c]of a){const l=e+s,i=r+c;if(i>=0&&i<n.length&&l>=0&&l<n[i].length&&!t[i][l]){t[i][l]=o,t[r][e]=null;break}}}function S(n,t,e,r,o,a,s){var g;const c=[],l=o-e,i=a-r,d=l===0?0:l>0?1:-1,m=i===0?0:i>0?1:-1;Math.abs(l)>=Math.abs(i)?c.push([d,0],[d,m],[0,m],[0,-m],[-d,0]):c.push([0,m],[d,m],[d,0],[-d,0],[0,-m]);for(const[u,v]of c){const f=e+u,p=r+v;if(p>=0&&p<n.length&&f>=0&&f<n[p].length&&!t[p][f]&&(!n[p][f]||((g=n[p][f])==null?void 0:g.army)!==s.army)){t[p][f]=s,t[r][e]=null;return}}}function q(n,t,e,r,o,a){const s=O(r,n,t,e.army.visionLength,e.army);if(s){const l=a.get(e.army),i=Math.abs(n-s[0])+Math.abs(t-s[1]);if((!l||i<Math.abs(n-l[0])+Math.abs(t-l[1]))&&a.set(e.army,s),P(n,t,s[0],s[1])){F(s,e,o);return}S(r,o,n,t,s[0],s[1],e);return}const c=a.get(e.army);c?P(n,t,c[0],c[1])?F(c,e,o):S(r,o,n,t,c[0],c[1],e):Y(r,o,n,t,e)}function $(n){const{fieldSize:t,armies:e}=n,r=Array.from({length:t},()=>Array.from({length:t},()=>null));return e.forEach((o,a)=>{H(o,a,r,t)}),{state:r,makeTurn(){const o=this.state.map(s=>s.slice()),a=new Map;for(let s=0;s<this.state.length;s++)for(let c=0;c<this.state[s].length;c++){const l=this.state[s][c];l&&q(c,s,l,this.state,o,a)}this.state=o}}}const w="game-field";function j(n){const t=document.createElement("div");t.classList.add("field-root"),t.style.setProperty("--n",n.toString()),t.id=w;for(let e=0;e<n;e++)for(let r=0;r<n;r++){const o=document.createElement("div");o.classList.add("field-cell"),t.append(o)}return t}function G(n,t){const e=document.getElementById(w);if(e&&e.style.getPropertyValue("--n")===n.toString())return e;e==null||e.remove();const r=j(n);return t.append(r),r}function R(){const n=document.createElement("div");return n.classList.add("game-soldier-icon"),n.innerHTML='<svg><use href="#icon-soldier" /></svg>',n}function A(n,t,e=null){const r=G(t.length,n);for(let o=0;o<t.length;o++)for(let a=0;a<t[o].length;a++){const s=r.children[o*t.length+a],c=t[o][a];s.removeAttribute("style"),s.innerHTML="",c&&(s.style.setProperty("--color",c.army.color),s.style.setProperty("--hp-percent",`${c.currentHp/c.army.hp*100}%`),s.append(R()))}}const W=[{id:"size",label:"Размер армии:",min:1,max:100,default:10},{id:"hp",label:"Здоровье солдата:",min:1,max:100,default:10},{id:"strength",label:"Сила удара:",min:1,max:10,default:1},{id:"visionLength",label:"Дальность обзора:",min:1,max:10,default:3},{id:"criticalPercent",label:"Шанс критического удара:",min:0,max:100,default:10}];function _(n){const t=document.createElement("form"),e=[];t.classList.add("p-3");const r=document.createElement("div");r.classList.add("mb-3","col-3");const o=document.createElement("label");o.textContent="Размер поля (N):",o.classList.add("form-label");const a=document.createElement("input");a.type="number",a.classList.add("form-control"),a.required=!0,a.min="1",a.max="100",a.value="10",r.append(o,a);const s=document.createElement("div");s.classList.add("mb-3","col-3");const c=document.createElement("label");c.textContent="Интервал (мс):",c.classList.add("form-label");const l=document.createElement("input");l.type="number",l.classList.add("form-control"),l.required=!0,l.min="1",l.value="1000",s.append(c,l);const i=()=>{const u=document.createElement("button");return u.type="submit",u.textContent="Запустить",u.classList.add("btn","btn-primary"),u},d=()=>{const u=document.createElement("button");u.type="button",u.textContent="Добавить армию",u.classList.add("btn","btn-secondary");const v=document.createElement("div");return v.classList.add("mb-3","row","flex-nowrap","gap-3"),u.addEventListener("click",()=>{const f=e.length;if(f<=3){const p=document.createElement("div");p.classList.add("card","mb-3","p-3","col-2");const I=document.createElement("h6");I.textContent=`Армия #${f+1}`,I.classList.add("card-title","mb-2"),p.appendChild(I);const E={color:"#9c4f4f"};W.forEach(h=>{const T=document.createElement("div");T.classList.add("mb-2");const C=document.createElement("label");C.textContent=h.label,C.classList.add("form-label","col-form-label-sm"),C.htmlFor=`army-${f}-${h.id}`;const b=document.createElement("input");b.type="number",b.id=`army-${f}-${h.id}`,b.classList.add("form-control","form-control-sm"),b.required=!0,b.min=h.min.toString(),b.max=h.max.toString(),b.value=h.default.toString(),b.addEventListener("change",()=>{E[h.id]=Number(b.value)}),E[h.id]=h.default,T.append(C,b),p.appendChild(T)});const L=document.createElement("input");L.type="color",L.value=E.color;const x=document.createElement("label");x.textContent="Цвет армии:",x.classList.add("form-label","col-form-label-sm"),L.addEventListener("change",()=>{E.color=L.value}),p.appendChild(x),p.appendChild(L),e.push(E),v.appendChild(p),t.insertAdjacentElement("beforeend",v)}else alert("Максимальное количество армий - 4")}),u},m=document.createElement("div");m.append(d(),i()),m.classList.add("btn-group");const g=document.createElement("div");return g.append(s,r),g.classList.add("row","mt-2"),t.append(m,g),t.addEventListener("submit",u=>{console.log(e),u.preventDefault(),e.length>1?n({fieldSize:Number(a.value),intervalMs:Number(l.value),armies:e}):alert("Армий должно быть больше одной")}),t}function N(n){return t=>{t.preventDefault(),n()}}function K(n,t){const e=document.createElement("div");e.classList.add("d-flex","my-3","justify-content-center"),e.style.gap="0.5em";const r=document.createElement("button");r.classList.add("btn","btn-secondary","game-btn-pause"),r.textContent="Пауза",r.addEventListener("click",N(t.pause));const o=document.createElement("button");o.classList.add("btn","btn-primary","game-btn-play"),o.textContent="Продолжить",o.addEventListener("click",N(t.play));const a=document.createElement("button");a.classList.add("btn","btn-warning"),a.textContent="Новая игра",a.addEventListener("click",N(t.reset)),e.append(r,o,a),n.append(e)}const y=document.getElementById("app");let M;function V(n){y.innerHTML="",clearInterval(M);const t=$(n);function e(){y.classList.add("game-playing"),y.classList.remove("game-paused"),M=setInterval(()=>{const o=t.state;t.makeTurn(),A(y,t.state,o)},n.intervalMs)}function r(){y.classList.add("game-paused"),y.classList.remove("game-playing"),clearInterval(M)}A(y,t.state),K(y,{pause:r,play:e,reset:B}),e()}function B(){clearInterval(M),y.innerHTML="";const n=_(V);y.append(n)}B();
